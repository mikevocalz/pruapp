{"ast":null,"code":"\"use strict\";var _regeneratorRuntime=require(\"@babel/runtime/regenerator\");var _asyncToGenerator=require(\"@babel/runtime/helpers/asyncToGenerator\");var _classCallCheck=require(\"@babel/runtime/helpers/classCallCheck\");var _createClass=require(\"@babel/runtime/helpers/createClass\");var _interopRequireDefault=require(\"@babel/runtime/helpers/interopRequireDefault\");exports.__esModule=true;exports[\"default\"]=exports.INITIAL_CSS_LOAD_ERROR=exports.looseToArray=void 0;var _mitt=_interopRequireDefault(require(\"../next-server/lib/mitt\"));var _router=require(\"../next-server/lib/router/router\");var _getAssetPathFromRoute=_interopRequireDefault(require(\"../next-server/lib/router/utils/get-asset-path-from-route\"));var _isDynamic=require(\"../next-server/lib/router/utils/is-dynamic\");var _parseRelativeUrl=require(\"../next-server/lib/router/utils/parse-relative-url\");var looseToArray=function looseToArray(input){return[].slice.call(input);};exports.looseToArray=looseToArray;function hasRel(rel,link){try{link=document.createElement('link');return link.relList.supports(rel);}catch(_unused){}}function pageLoadError(route){return(0,_router.markLoadingError)(new Error(\"Error loading \".concat(route)));}var INITIAL_CSS_LOAD_ERROR=Symbol('INITIAL_CSS_LOAD_ERROR');exports.INITIAL_CSS_LOAD_ERROR=INITIAL_CSS_LOAD_ERROR;var relPrefetch=hasRel('preload')&&!hasRel('prefetch')?'preload':'prefetch';var relPreload=hasRel('preload')?'preload':relPrefetch;var relPreloadStyle='fetch';var hasNoModule=('noModule'in document.createElement('script'));function normalizeRoute(route){if(route[0]!=='/'){throw new Error(\"Route name should start with a \\\"/\\\", got \\\"\".concat(route,\"\\\"\"));}if(route==='/')return route;return route.replace(/\\/$/,'');}function appendLink(href,rel,as,link){return new Promise(function(res,rej){link=document.createElement('link');if(as)link.as=as;link.rel=rel;link.crossOrigin=process.env.__NEXT_CROSS_ORIGIN;link.onload=res;link.onerror=rej;link.href=href;document.head.appendChild(link);});}function loadScript(url){return new Promise(function(res,rej){var script=document.createElement('script');if(process.env.__NEXT_MODERN_BUILD&&hasNoModule){script.type='module';}script.crossOrigin=process.env.__NEXT_CROSS_ORIGIN;script.src=url;script.onload=res;script.onerror=function(){return rej(pageLoadError(url));};document.body.appendChild(script);});}var PageLoader=function(){function PageLoader(buildId,assetPrefix,initialPage){_classCallCheck(this,PageLoader);this.initialPage=void 0;this.buildId=void 0;this.assetPrefix=void 0;this.pageCache=void 0;this.pageRegisterEvents=void 0;this.loadingRoutes=void 0;this.promisedBuildManifest=void 0;this.promisedSsgManifest=void 0;this.promisedDevPagesManifest=void 0;this.initialPage=initialPage;this.buildId=buildId;this.assetPrefix=assetPrefix;this.pageCache={};this.pageRegisterEvents=(0,_mitt[\"default\"])();this.loadingRoutes={'/_app':true};if(initialPage!=='/_error'){this.loadingRoutes[initialPage]=true;}this.promisedBuildManifest=new Promise(function(resolve){if(window.__BUILD_MANIFEST){resolve(window.__BUILD_MANIFEST);}else{;window.__BUILD_MANIFEST_CB=function(){resolve(window.__BUILD_MANIFEST);};}});this.promisedSsgManifest=new Promise(function(resolve){if(window.__SSG_MANIFEST){resolve(window.__SSG_MANIFEST);}else{;window.__SSG_MANIFEST_CB=function(){resolve(window.__SSG_MANIFEST);};}});}_createClass(PageLoader,[{key:\"getPageList\",value:function getPageList(){if(false){return this.promisedBuildManifest.then(function(buildManifest){return buildManifest.sortedPages;});}else{if(window.__DEV_PAGES_MANIFEST){return window.__DEV_PAGES_MANIFEST.pages;}else{if(!this.promisedDevPagesManifest){this.promisedDevPagesManifest=fetch(\"\".concat(this.assetPrefix,\"/_next/static/development/_devPagesManifest.json\")).then(function(res){return res.json();}).then(function(manifest){;window.__DEV_PAGES_MANIFEST=manifest;return manifest.pages;})[\"catch\"](function(err){console.log(\"Failed to fetch devPagesManifest\",err);});}return this.promisedDevPagesManifest;}}}},{key:\"getDependencies\",value:function getDependencies(route){var _this2=this;return this.promisedBuildManifest.then(function(m){return m[route]?m[route].map(function(url){return\"\".concat(_this2.assetPrefix,\"/_next/\").concat(encodeURI(url));}):Promise.reject(pageLoadError(route));});}},{key:\"getDataHref\",value:function getDataHref(href,asPath,ssg,locale){var _this3=this;var _ref=(0,_parseRelativeUrl.parseRelativeUrl)(href),hrefPathname=_ref.pathname,query=_ref.query,search=_ref.search;var _ref2=(0,_parseRelativeUrl.parseRelativeUrl)(asPath),asPathname=_ref2.pathname;var route=normalizeRoute(hrefPathname);var getHrefForSlug=function getHrefForSlug(path){var dataRoute=(0,_router.addLocale)((0,_getAssetPathFromRoute[\"default\"])(path,'.json'),locale);return(0,_router.addBasePath)(\"/_next/data/\".concat(_this3.buildId).concat(dataRoute).concat(ssg?'':search));};var isDynamic=(0,_isDynamic.isDynamicRoute)(route);var interpolatedRoute=isDynamic?(0,_router.interpolateAs)(hrefPathname,asPathname,query).result:'';return isDynamic?interpolatedRoute&&getHrefForSlug(interpolatedRoute):getHrefForSlug(route);}},{key:\"prefetchData\",value:function prefetchData(href,asPath,locale){var _this4=this;var _ref3=(0,_parseRelativeUrl.parseRelativeUrl)(href),hrefPathname=_ref3.pathname;var route=normalizeRoute(hrefPathname);return this.promisedSsgManifest.then(function(s,_dataHref){return s.has(route)&&(_dataHref=_this4.getDataHref(href,asPath,true,locale))&&!document.querySelector(\"link[rel=\\\"\".concat(relPrefetch,\"\\\"][href^=\\\"\").concat(_dataHref,\"\\\"]\"))&&appendLink(_dataHref,relPrefetch,'fetch')[\"catch\"](function(){});});}},{key:\"loadPage\",value:function loadPage(route){var _this5=this;route=normalizeRoute(route);return new Promise(function(resolve,reject){var cachedPage=_this5.pageCache[route];if(cachedPage){if('error'in cachedPage){reject(cachedPage.error);}else{resolve(cachedPage);}return;}var fire=function fire(pageToCache){_this5.pageRegisterEvents.off(route,fire);delete _this5.loadingRoutes[route];if('error'in pageToCache){reject(pageToCache.error);}else{resolve(pageToCache);}};_this5.pageRegisterEvents.on(route,fire);if(!_this5.loadingRoutes[route]){_this5.loadingRoutes[route]=true;if(false){_this5.getDependencies(route).then(function(deps){var pending=[];deps.forEach(function(d){if(d.endsWith('.js')&&!document.querySelector(\"script[src^=\\\"\".concat(d,\"\\\"]\"))){pending.push(loadScript(d));}if(d.endsWith('.css')&&!document.querySelector(\"link[rel=\\\"\".concat(relPreload,\"\\\"][href^=\\\"\").concat(d,\"\\\"]\"))){appendLink(d,relPreload,relPreloadStyle)[\"catch\"](function(){});}});return Promise.all(pending);})[\"catch\"](function(err){_this5.pageCache[route]={error:err};fire({error:err});});}else{route=normalizeRoute(route);var scriptRoute=(0,_getAssetPathFromRoute[\"default\"])(route,'.js');var url=\"\".concat(_this5.assetPrefix,\"/_next/static/chunks/pages\").concat(encodeURI(scriptRoute));loadScript(url)[\"catch\"](function(err){_this5.pageCache[route]={error:err};fire({error:err});});}}});}},{key:\"registerPage\",value:function registerPage(route,regFn){var _this6=this;var _this=this;var register=function(){var _register=_asyncToGenerator(_regeneratorRuntime.mark(function _callee(styleSheets){var mod,pageData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return regFn();case 3:mod=_context.sent;pageData={page:mod[\"default\"]||mod,mod:mod,styleSheets:styleSheets};_this.pageCache[route]=pageData;_this.pageRegisterEvents.emit(route,pageData);_context.next=13;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](0);_this.pageCache[route]={error:_context.t0};_this.pageRegisterEvents.emit(route,{error:_context.t0});case 13:case\"end\":return _context.stop();}}},_callee,null,[[0,9]]);}));function register(_x){return _register.apply(this,arguments);}return register;}();if(true){if(module.hot&&module.hot.status()!=='idle'){console.log(\"Waiting for webpack to become \\\"idle\\\" to initialize the page: \\\"\".concat(route,\"\\\"\"));var check=function check(status){if(status==='idle'){;module.hot.removeStatusHandler(check);register([]);}};module.hot.status(check);return;}}function fetchStyleSheet(href){return fetch(href).then(function(res){if(!res.ok)throw pageLoadError(href);return res.text().then(function(text){return{href:href,text:text};});});}var isInitialLoad=route===this.initialPage;var promisedDeps=route==='/_app'||true?Promise.resolve([]):(isInitialLoad?Promise.resolve(looseToArray(document.querySelectorAll('link[data-n-p]')).map(function(e){return e.getAttribute('href');})):this.getDependencies(route).then(function(deps){return deps.filter(function(d){return d.endsWith('.css');});})).then(function(cssFiles){return Promise.all(cssFiles.map(function(d){return fetchStyleSheet(d);}))[\"catch\"](function(err){if(isInitialLoad){Object.defineProperty(err,INITIAL_CSS_LOAD_ERROR,{});}throw err;});});promisedDeps.then(function(deps){return register(deps);},function(error){_this6.pageCache[route]={error:error};_this6.pageRegisterEvents.emit(route,{error:error});});}},{key:\"prefetch\",value:function prefetch(route,isDependency){var _this7=this;var cn;if(cn=navigator.connection){if(cn.saveData||/2g/.test(cn.effectiveType))return Promise.resolve();}var url;if(isDependency){url=route;}else{if(true){route=normalizeRoute(route);var ext=process.env.__NEXT_MODERN_BUILD&&hasNoModule?'.module.js':'.js';var scriptRoute=(0,_getAssetPathFromRoute[\"default\"])(route,ext);url=\"\".concat(this.assetPrefix,\"/_next/static/\").concat(encodeURIComponent(this.buildId),\"/pages\").concat(encodeURI(scriptRoute));}}return Promise.all(document.querySelector(\"link[rel=\\\"\".concat(relPrefetch,\"\\\"][href^=\\\"\").concat(url,\"\\\"]\"))?[]:[url&&appendLink(url,relPrefetch,url.endsWith('.css')?relPreloadStyle:'script'),false&&!isDependency&&this.getDependencies(route).then(function(urls){return Promise.all(urls.map(function(dependencyUrl){return _this7.prefetch(dependencyUrl,true);}));})]).then(function(){},function(){});}}]);return PageLoader;}();exports[\"default\"]=PageLoader;","map":{"version":3,"sources":["../../client/page-loader.ts"],"names":["looseToArray","input","link","document","INITIAL_CSS_LOAD_ERROR","Symbol","relPrefetch","hasRel","relPreload","relPreloadStyle","hasNoModule","route","process","script","rej","pageLoadError","PageLoader","initialPage","buildId","assetPrefix","pageCache","pageRegisterEvents","loadingRoutes","promisedBuildManifest","promisedSsgManifest","promisedDevPagesManifest","constructor","resolve","window","getPageList","buildManifest","fetch","res","manifest","err","console","m","url","encodeURI","Promise","pathname","normalizeRoute","getHrefForSlug","path","dataRoute","ssg","isDynamic","interpolatedRoute","s","_dataHref","appendLink","loadPage","cachedPage","reject","fire","pageToCache","deps","pending","d","loadScript","error","scriptRoute","register","mod","regFn","pageData","page","styleSheets","module","check","status","text","href","isInitialLoad","promisedDeps","e","cssFiles","fetchStyleSheet","Object","cn","navigator","ext","encodeURIComponent","urls","dependencyUrl"],"mappings":"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","sourcesContent":["import { ComponentType } from 'react'\nimport type { ClientSsgManifest } from '../build'\nimport type { ClientBuildManifest } from '../build/webpack/plugins/build-manifest-plugin'\nimport type { MittEmitter } from '../next-server/lib/mitt'\nimport mitt from '../next-server/lib/mitt'\nimport {\n  addBasePath,\n  addLocale,\n  interpolateAs,\n  markLoadingError,\n} from '../next-server/lib/router/router'\nimport getAssetPathFromRoute from '../next-server/lib/router/utils/get-asset-path-from-route'\nimport { isDynamicRoute } from '../next-server/lib/router/utils/is-dynamic'\nimport { parseRelativeUrl } from '../next-server/lib/router/utils/parse-relative-url'\n\nexport const looseToArray = <T extends {}>(input: any): T[] =>\n  [].slice.call(input)\n\nfunction hasRel(rel: string, link?: HTMLLinkElement) {\n  try {\n    link = document.createElement('link')\n    return link.relList.supports(rel)\n  } catch {}\n}\n\nfunction pageLoadError(route: string) {\n  return markLoadingError(new Error(`Error loading ${route}`))\n}\n\nexport const INITIAL_CSS_LOAD_ERROR = Symbol('INITIAL_CSS_LOAD_ERROR')\n\nconst relPrefetch =\n  hasRel('preload') && !hasRel('prefetch')\n    ? // https://caniuse.com/#feat=link-rel-preload\n      // macOS and iOS (Safari does not support prefetch)\n      'preload'\n    : // https://caniuse.com/#feat=link-rel-prefetch\n      // IE 11, Edge 12+, nearly all evergreen\n      'prefetch'\n\nconst relPreload = hasRel('preload') ? 'preload' : relPrefetch\nconst relPreloadStyle = 'fetch'\n\nconst hasNoModule = 'noModule' in document.createElement('script')\n\nfunction normalizeRoute(route: string) {\n  if (route[0] !== '/') {\n    throw new Error(`Route name should start with a \"/\", got \"${route}\"`)\n  }\n\n  if (route === '/') return route\n  return route.replace(/\\/$/, '')\n}\n\nfunction appendLink(\n  href: string,\n  rel: string,\n  as?: string,\n  link?: HTMLLinkElement\n): Promise<any> {\n  return new Promise((res, rej) => {\n    link = document.createElement('link')\n\n    // The order of property assignment here is intentional:\n    if (as) link!.as = as\n    link!.rel = rel\n    link!.crossOrigin = process.env.__NEXT_CROSS_ORIGIN!\n    link!.onload = res\n    link!.onerror = rej\n\n    // `href` should always be last:\n    link!.href = href\n\n    document.head.appendChild(link)\n  })\n}\n\nfunction loadScript(url: string): Promise<any> {\n  return new Promise((res, rej) => {\n    const script = document.createElement('script')\n    if (process.env.__NEXT_MODERN_BUILD && hasNoModule) {\n      script.type = 'module'\n    }\n    script.crossOrigin = process.env.__NEXT_CROSS_ORIGIN!\n    script.src = url\n    script.onload = res\n    script.onerror = () => rej(pageLoadError(url))\n    document.body.appendChild(script)\n  })\n}\n\nexport type StyleSheetTuple = { href: string; text: string }\nexport type GoodPageCache = {\n  page: ComponentType\n  mod: any\n  styleSheets: StyleSheetTuple[]\n}\nexport type PageCacheEntry = { error: any } | GoodPageCache\n\nexport default class PageLoader {\n  private initialPage: string\n  private buildId: string\n  private assetPrefix: string\n  private pageCache: Record<string, PageCacheEntry>\n  private pageRegisterEvents: MittEmitter\n  private loadingRoutes: Record<string, boolean>\n  private promisedBuildManifest?: Promise<ClientBuildManifest>\n  private promisedSsgManifest?: Promise<ClientSsgManifest>\n  private promisedDevPagesManifest?: Promise<any>\n\n  constructor(buildId: string, assetPrefix: string, initialPage: string) {\n    this.initialPage = initialPage\n\n    this.buildId = buildId\n    this.assetPrefix = assetPrefix\n\n    this.pageCache = {}\n    this.pageRegisterEvents = mitt()\n    this.loadingRoutes = {\n      // By default these 2 pages are being loaded in the initial html\n      '/_app': true,\n    }\n\n    // TODO: get rid of this limitation for rendering the error page\n    if (initialPage !== '/_error') {\n      this.loadingRoutes[initialPage] = true\n    }\n\n    this.promisedBuildManifest = new Promise((resolve) => {\n      if ((window as any).__BUILD_MANIFEST) {\n        resolve((window as any).__BUILD_MANIFEST)\n      } else {\n        ;(window as any).__BUILD_MANIFEST_CB = () => {\n          resolve((window as any).__BUILD_MANIFEST)\n        }\n      }\n    })\n\n    /** @type {Promise<Set<string>>} */\n    this.promisedSsgManifest = new Promise((resolve) => {\n      if ((window as any).__SSG_MANIFEST) {\n        resolve((window as any).__SSG_MANIFEST)\n      } else {\n        ;(window as any).__SSG_MANIFEST_CB = () => {\n          resolve((window as any).__SSG_MANIFEST)\n        }\n      }\n    })\n  }\n\n  getPageList() {\n    if (process.env.NODE_ENV === 'production') {\n      return this.promisedBuildManifest!.then(\n        (buildManifest) => buildManifest.sortedPages\n      )\n    } else {\n      if ((window as any).__DEV_PAGES_MANIFEST) {\n        return (window as any).__DEV_PAGES_MANIFEST.pages\n      } else {\n        if (!this.promisedDevPagesManifest) {\n          this.promisedDevPagesManifest = fetch(\n            `${this.assetPrefix}/_next/static/development/_devPagesManifest.json`\n          )\n            .then((res) => res.json())\n            .then((manifest) => {\n              ;(window as any).__DEV_PAGES_MANIFEST = manifest\n              return manifest.pages\n            })\n            .catch((err) => {\n              console.log(`Failed to fetch devPagesManifest`, err)\n            })\n        }\n        return this.promisedDevPagesManifest\n      }\n    }\n  }\n\n  // Returns a promise for the dependencies for a particular route\n  private getDependencies(route: string): Promise<string[]> {\n    return this.promisedBuildManifest!.then((m) => {\n      return m[route]\n        ? m[route].map((url) => `${this.assetPrefix}/_next/${encodeURI(url)}`)\n        : Promise.reject(pageLoadError(route))\n    })\n  }\n\n  /**\n   * @param {string} href the route href (file-system path)\n   * @param {string} asPath the URL as shown in browser (virtual path); used for dynamic routes\n   */\n  getDataHref(\n    href: string,\n    asPath: string,\n    ssg: boolean,\n    locale?: string | false\n  ) {\n    const { pathname: hrefPathname, query, search } = parseRelativeUrl(href)\n    const { pathname: asPathname } = parseRelativeUrl(asPath)\n    const route = normalizeRoute(hrefPathname)\n\n    const getHrefForSlug = (path: string) => {\n      const dataRoute = addLocale(getAssetPathFromRoute(path, '.json'), locale)\n      return addBasePath(\n        `/_next/data/${this.buildId}${dataRoute}${ssg ? '' : search}`\n      )\n    }\n\n    const isDynamic: boolean = isDynamicRoute(route)\n    const interpolatedRoute = isDynamic\n      ? interpolateAs(hrefPathname, asPathname, query).result\n      : ''\n\n    return isDynamic\n      ? interpolatedRoute && getHrefForSlug(interpolatedRoute)\n      : getHrefForSlug(route)\n  }\n\n  /**\n   * @param {string} href the route href (file-system path)\n   * @param {string} asPath the URL as shown in browser (virtual path); used for dynamic routes\n   */\n  prefetchData(href: string, asPath: string, locale?: string | false) {\n    const { pathname: hrefPathname } = parseRelativeUrl(href)\n    const route = normalizeRoute(hrefPathname)\n    return this.promisedSsgManifest!.then(\n      (s: ClientSsgManifest, _dataHref?: string) =>\n        // Check if the route requires a data file\n        s.has(route) &&\n        // Try to generate data href, noop when falsy\n        (_dataHref = this.getDataHref(href, asPath, true, locale)) &&\n        // noop when data has already been prefetched (dedupe)\n        !document.querySelector(\n          `link[rel=\"${relPrefetch}\"][href^=\"${_dataHref}\"]`\n        ) &&\n        // Inject the `<link rel=prefetch>` tag for above computed `href`.\n        appendLink(_dataHref, relPrefetch, 'fetch').catch(() => {\n          /* ignore prefetch error */\n        })\n    )\n  }\n\n  loadPage(route: string): Promise<GoodPageCache> {\n    route = normalizeRoute(route)\n\n    return new Promise<GoodPageCache>((resolve, reject) => {\n      // If there's a cached version of the page, let's use it.\n      const cachedPage = this.pageCache[route]\n      if (cachedPage) {\n        if ('error' in cachedPage) {\n          reject(cachedPage.error)\n        } else {\n          resolve(cachedPage)\n        }\n        return\n      }\n\n      const fire = (pageToCache: PageCacheEntry) => {\n        this.pageRegisterEvents.off(route, fire)\n        delete this.loadingRoutes[route]\n\n        if ('error' in pageToCache) {\n          reject(pageToCache.error)\n        } else {\n          resolve(pageToCache)\n        }\n      }\n\n      // Register a listener to get the page\n      this.pageRegisterEvents.on(route, fire)\n\n      if (!this.loadingRoutes[route]) {\n        this.loadingRoutes[route] = true\n        if (process.env.NODE_ENV === 'production') {\n          this.getDependencies(route)\n            .then((deps) => {\n              const pending: Promise<any>[] = []\n              deps.forEach((d) => {\n                if (\n                  d.endsWith('.js') &&\n                  !document.querySelector(`script[src^=\"${d}\"]`)\n                ) {\n                  pending.push(loadScript(d))\n                }\n\n                // Prefetch CSS as it'll be needed when the page JavaScript\n                // evaluates. This will only trigger if explicit prefetching is\n                // disabled for a <Link>... prefetching in this case is desirable\n                // because we *know* it's going to be used very soon (page was\n                // loaded).\n                if (\n                  d.endsWith('.css') &&\n                  !document.querySelector(\n                    `link[rel=\"${relPreload}\"][href^=\"${d}\"]`\n                  )\n                ) {\n                  // This is not pushed into `pending` because we don't need to\n                  // wait for these to resolve. To prevent an unhandled\n                  // rejection, we swallow the error which is handled later in\n                  // the rendering cycle (this is just a preload optimization).\n                  appendLink(d, relPreload, relPreloadStyle).catch(() => {\n                    /* ignore preload error */\n                  })\n                }\n              })\n              return Promise.all(pending)\n            })\n            .catch((err) => {\n              // Mark the page as failed to load if any of its required scripts\n              // fail to load:\n              this.pageCache[route] = { error: err }\n              fire({ error: err })\n            })\n        } else {\n          // Development only. In production the page file is part of the build manifest\n          route = normalizeRoute(route)\n          let scriptRoute = getAssetPathFromRoute(route, '.js')\n\n          const url = `${this.assetPrefix}/_next/static/chunks/pages${encodeURI(\n            scriptRoute\n          )}`\n          loadScript(url).catch((err) => {\n            // Mark the page as failed to load if its script fails to load:\n            this.pageCache[route] = { error: err }\n            fire({ error: err })\n          })\n        }\n      }\n    })\n  }\n\n  // This method if called by the route code.\n  registerPage(route: string, regFn: () => any) {\n    const register = async (styleSheets: StyleSheetTuple[]) => {\n      try {\n        const mod = await regFn()\n        const pageData: PageCacheEntry = {\n          page: mod.default || mod,\n          mod,\n          styleSheets,\n        }\n        this.pageCache[route] = pageData\n        this.pageRegisterEvents.emit(route, pageData)\n      } catch (error) {\n        this.pageCache[route] = { error }\n        this.pageRegisterEvents.emit(route, { error })\n      }\n    }\n\n    if (process.env.NODE_ENV !== 'production') {\n      // Wait for webpack to become idle if it's not.\n      // More info: https://github.com/vercel/next.js/pull/1511\n      if ((module as any).hot && (module as any).hot.status() !== 'idle') {\n        console.log(\n          `Waiting for webpack to become \"idle\" to initialize the page: \"${route}\"`\n        )\n\n        const check = (status: string) => {\n          if (status === 'idle') {\n            ;(module as any).hot.removeStatusHandler(check)\n            register(\n              /* css is handled via style-loader in development */\n              []\n            )\n          }\n        }\n        ;(module as any).hot.status(check)\n        return\n      }\n    }\n\n    function fetchStyleSheet(href: string): Promise<StyleSheetTuple> {\n      return fetch(href).then((res) => {\n        if (!res.ok) throw pageLoadError(href)\n        return res.text().then((text) => ({ href, text }))\n      })\n    }\n\n    const isInitialLoad = route === this.initialPage\n    const promisedDeps: Promise<StyleSheetTuple[]> =\n      // Shared styles will already be on the page:\n      route === '/_app' ||\n      // We use `style-loader` in development:\n      process.env.NODE_ENV !== 'production'\n        ? Promise.resolve([])\n        : // Tests that this does not block hydration:\n          // test/integration/css-fixtures/hydrate-without-deps/\n          (isInitialLoad\n            ? Promise.resolve(\n                looseToArray<HTMLLinkElement>(\n                  document.querySelectorAll('link[data-n-p]')\n                ).map((e) => e.getAttribute('href')!)\n              )\n            : this.getDependencies(route).then((deps) =>\n                deps.filter((d) => d.endsWith('.css'))\n              )\n          ).then((cssFiles) =>\n            // These files should've already been fetched by now, so this\n            // should resolve instantly.\n            Promise.all(cssFiles.map((d) => fetchStyleSheet(d))).catch(\n              (err) => {\n                if (isInitialLoad) {\n                  Object.defineProperty(err, INITIAL_CSS_LOAD_ERROR, {})\n                }\n                throw err\n              }\n            )\n          )\n    promisedDeps.then(\n      (deps) => register(deps),\n      (error) => {\n        this.pageCache[route] = { error }\n        this.pageRegisterEvents.emit(route, { error })\n      }\n    )\n  }\n\n  /**\n   * @param {string} route\n   * @param {boolean} [isDependency]\n   */\n  prefetch(route: string, isDependency?: boolean): Promise<void> {\n    // https://github.com/GoogleChromeLabs/quicklink/blob/453a661fa1fa940e2d2e044452398e38c67a98fb/src/index.mjs#L115-L118\n    // License: Apache 2.0\n    let cn\n    if ((cn = (navigator as any).connection)) {\n      // Don't prefetch if using 2G or if Save-Data is enabled.\n      if (cn.saveData || /2g/.test(cn.effectiveType)) return Promise.resolve()\n    }\n\n    /** @type {string} */\n    let url\n    if (isDependency) {\n      url = route\n    } else {\n      if (process.env.NODE_ENV !== 'production') {\n        route = normalizeRoute(route)\n\n        const ext =\n          process.env.__NEXT_MODERN_BUILD && hasNoModule ? '.module.js' : '.js'\n        const scriptRoute = getAssetPathFromRoute(route, ext)\n\n        url = `${this.assetPrefix}/_next/static/${encodeURIComponent(\n          this.buildId\n        )}/pages${encodeURI(scriptRoute)}`\n      }\n    }\n\n    return Promise.all(\n      document.querySelector(`link[rel=\"${relPrefetch}\"][href^=\"${url}\"]`)\n        ? []\n        : [\n            url &&\n              appendLink(\n                url,\n                relPrefetch,\n                url.endsWith('.css') ? relPreloadStyle : 'script'\n              ),\n            process.env.NODE_ENV === 'production' &&\n              !isDependency &&\n              this.getDependencies(route).then((urls) =>\n                Promise.all(\n                  urls.map((dependencyUrl) =>\n                    this.prefetch(dependencyUrl, true)\n                  )\n                )\n              ),\n          ]\n    ).then(\n      // do not return any data\n      () => {},\n      // swallow prefetch errors\n      () => {}\n    )\n  }\n}\n"]},"metadata":{},"sourceType":"script"}